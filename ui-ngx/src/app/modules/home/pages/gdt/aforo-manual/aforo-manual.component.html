<div class="tb-absolute-fill">
  <mat-toolbar color="primary">
    <h2>
      <mat-icon class="tb-mat-20">edit</mat-icon>
      <span>Aforo Manual</span>
    </h2>
    <span fxFlex></span>
    <button mat-icon-button
            matTooltip="Ayuda"
            matTooltipPosition="below">
      <mat-icon>help_outline</mat-icon>
    </button>
  </mat-toolbar>

  <div class="mat-content tb-form-panel no-border no-padding" fxLayout="column">
    <div class="mat-content" fxLayout="column" fxFlex>
      
      <!-- Tank Selector -->
      <div class="tb-form-panel stroked" style="margin: 16px;">
        <div class="tb-form-panel-title">Seleccionar Tanque</div>
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="16px">
          <mat-form-field fxFlex appearance="outline" class="mat-block">
            <mat-label>Tanque</mat-label>
            <mat-select [(value)]="selectedTank"
                        (selectionChange)="onTankSelected($event.value)"
                        [disabled]="loading">
              <mat-option *ngFor="let tank of tanks" [value]="tank">
                {{ tank.attributes.tankTag || tank.asset.name }} - {{ tank.attributes.productName || 'Sin producto' }}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix>storage</mat-icon>
            <mat-progress-spinner *ngIf="loading"
                                  mode="indeterminate"
                                  diameter="20"
                                  matSuffix>
            </mat-progress-spinner>
          </mat-form-field>
        </div>
      </div>

      <!-- Main Content -->
      <div fxLayout="row" fxLayoutGap="16px" style="padding: 0 16px 16px 16px;" fxFlex>
        
        <!-- Left Panel: Form -->
        <div fxFlex="40" fxLayout="column">
          <tb-aforo-form 
            [selectedTank]="selectedTank"
            [widgetContext]="widgetContext"
            (entrySaved)="onEntrySaved($event)">
          </tb-aforo-form>
        </div>

        <!-- Right Panel: History -->
        <div fxFlex="60" fxLayout="column">
          <tb-aforo-history
            [selectedTank]="selectedTank"
            [telemetryHistory]="telemetryHistory"
            [loading]="loadingHistory">
          </tb-aforo-history>
        </div>

      </div>

    </div>
  </div>
</div>
