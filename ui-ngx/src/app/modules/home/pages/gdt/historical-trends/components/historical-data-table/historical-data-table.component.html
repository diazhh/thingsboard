<div class="historical-data-table-container">
  <!-- Filter -->
  <mat-form-field appearance="outline" class="filter-field">
    <mat-label>Buscar</mat-label>
    <input matInput (keyup)="applyFilter($event)" placeholder="Filtrar datos...">
    <mat-icon matSuffix>search</mat-icon>
  </mat-form-field>

  <!-- Export Button -->
  <button mat-raised-button color="primary" (click)="exportToCSV()" class="export-button">
    <mat-icon>download</mat-icon>
    Exportar CSV
  </button>

  <!-- Table -->
  <div class="table-container">
    <table mat-table [dataSource]="dataSource" matSort class="data-table">
      
      <!-- Timestamp Column -->
      <ng-container matColumnDef="timestamp">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha y Hora</th>
        <td mat-cell *matCellDef="let row">{{ row.timestampFormatted }}</td>
      </ng-container>

      <!-- Dynamic Columns -->
      <ng-container *ngFor="let column of displayedColumns.slice(1)" [matColumnDef]="column">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          {{ getColumnHeader(column) }}
        </th>
        <td mat-cell *matCellDef="let row">
          {{ formatValue(row[column]) }}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <!-- No Data Row -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell no-data" [attr.colspan]="displayedColumns.length">
          <mat-icon>info</mat-icon>
          <span>No hay datos disponibles</span>
        </td>
      </tr>
    </table>
  </div>

  <!-- Paginator -->
  <mat-paginator 
    [pageSize]="pageSize"
    [pageSizeOptions]="pageSizeOptions"
    showFirstLastButtons
    aria-label="Seleccionar pÃ¡gina">
  </mat-paginator>
</div>
